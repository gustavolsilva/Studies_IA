FROM node:22-alpine

# Instalar Python, build tools e watchman para hot-reload
RUN apk add --no-cache python3 py3-pip build-base watchman

WORKDIR /app

# Copiar manifests
COPY package.json pnpm-lock.yaml* ./
COPY tsconfig.json tsconfig.node.json ./

# Instalar dependências (sem cache para sempre limpo)
RUN npm ci --no-optional

# Copiar código-fonte
COPY . .

# Gerar banco de perguntas antes de dev
RUN python3 generate_questions_enhanced.py || true

EXPOSE 3000

ENV NODE_ENV=development
CMD ["npm", "run", "dev"]
